<template>
  <div class="row">
    <div class="col m3">
      Mapped Keywords/New Keywords:
      <br>
      ${keywords_done}/${keywords_todo}
    </div>
    <div class="col m4">
      <button md-button style="width: 100%" click.delegate="applyLabel()">Apply Label to Keyword</button>
    </div>
    <div class="col m5">
      Finished Documents/New Documents:
      <br>
      ${docs_done}/${docs_todo}
    </div>
  </div>
  <div class="row">
    <!-- Keyword View -->
    <div class="col m3">
      <input type="text" class="form-control search-box" value.bind="searchKeywordsTerm"
        placeholder="search Keywords..."></input>
      <md-checkbox checked.bind="finishedKeywords">Show finished
      </md-checkbox>
      <div class="row" style="overflow: scroll; height: 100vh;">
        <table>
          <thead>
            <tr>
              <th>
                <span style="font-size: x-large">Author Keywords</span>
              </th>
              <th>Mapping</th>
              <th style="cursor: pointer" click.delegate="setKeywordSortProperty('count')">#</th>
              <th style="cursor: pointer" click.delegate="setKeywordSortProperty('highest_value')">Highest Sim</th>
            </tr>
          </thead>
          <tbody>
            <tr
              repeat.for="keyword of keyword_list | customSort: { propertyName: key_property, direction: 'descending' } | filter:searchKeywordsTerm:filterKeywordsFunc | filterProperty: finishedKeywords:'isDone'"
              click.delegate="selectKeyword(keyword)"
              css="cursor: pointer; background-color: ${keyword.isActive ? '#50c6f1' : keyword.isDone ? '#0df2c9' : None};">
              <td>
                ${keyword["keyword"]}
              </td>
              <td style="word-break: break-all;">
                ${keyword["mapping"]}
              </td>
              <td>${keyword["count"]}</td>
              <td as-element="small-bar" percent="${keyword['highest_value']}" orientation="horizontal" xSize="100"
                ySize="20">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="col m4">
      <!-- Labels View -->
      <input type="text" class="form-control search-box" value.bind="searchLabelsTerm"
        placeholder="search Labels..."></input>
      <div class="row" style="overflow: scroll; height: 60vh;">
        <table>
          <thead>
            <tr>
              <th><span style="font-size: x-large">Labels</span></th>
              <th style="cursor: pointer" click.delegate="setLabelSortProperty('n_docs')">Count</th>
              <th style="cursor: pointer" click.delegate="setLabelSortProperty('substring_similarity')">Label Substring
              </th>
              <th style="cursor: pointer" click.delegate="setLabelSortProperty('keyword_substring_similarity')">Keyword
                Substring</th>
              <!-- <th style="cursor: pointer" click.delegate="setLabelSortProperty('keyword_avg_similarity')">Sim Hist</th> -->
            </tr>
          </thead>
          <tbody>
            <tr
              repeat.for="label_object of label_docs | customSort: { propertyName: label_sort_property, direction: 'descending' } | filter:searchLabelsTerm:filterLabelsFunc"
              css="cursor: pointer; background-color: ${label_object['isActive'] ? '#50c6f1' : None};"
              click.delegate="selectLabel(label_object)">
              <td style="word-break: break-all;">
                ${label_object['label']}
              </td>
              <td>${label_object['n_docs']}</td>
              <td as-element="small-bar" percent="${label_object['substring_similarity']}" orientation="vertical"
                xSize="15" , ySize="40">
              </td>
              <td as-element="small-bar" percent="${label_object['keyword_substring_similarity']}"
                orientation="vertical" xSize="15" , ySize="40">
              </td>
              <!-- <td as-element="bar-chart" data="${label_object['keyword_similarities']}"></td> -->
            </tr>
          </tbody>
        </table>
      </div>
      <hr style="margin: 0">
      <div class="row" style="overflow: scroll; height: 40vh;">
        <table>
          <thead>
            <tr>
              <th>Co-Occurring Keywords</th>
              <th>Label</th>
              <th>#</th>
              <th>Co-Occurrence Similarity</th>
          </thead>
          <tbody>
            <tr repeat.for="cooc of selected_similar_keywords | customSort: { propertyName: 'count',
              direction: 'descending' }">
              <td>
                ${cooc.keyword.keyword}
              </td>
              <td style="word-break: break-all">
                ${cooc.keyword.mapping}
              </td>
              <td>
                ${cooc.count}
              </td>
              <td as-element="small-bar" percent="${cooc.cooc_sim}" orientation="horizontal" xSize="100" ySize="20">
            </tr>
          </tbody>
        </table>
      </div>
      <hr>
    </div>
    <div class="col m5">
      <!-- Document List View -->
      <div class="row" style="overflow: scroll; height: 60vh; margin-left: 10px; margin-right: 10px;">
        <table>
          <thead>
            <tr>
              <th><span style="font-size: x-large">Documents</span></th>
              <th style="cursor: pointer" click.delegate="setSortProperty('text_similarity')">Text Sim
              </th>
              <th style="cursor: pointer" click.delegate="setSortProperty('keyword_similarity')">Keyword
                Sim</th>
            </tr>
          </thead>
          <tbody>
            <tr
              repeat.for="sim of selected_similarities | customSort: { propertyName: sim_property, direction: sort_property }"
              click.delegate="selectDocument(sim.document)"
              css="cursor: pointer; background-color: ${sim.document['type'] == 'old' ? 'lightgrey' : none}">
              <td>
                <strong>
                  ${sim.document["Title"]}
                </strong>
                <br>
                <br>
                ${sim.document["Keywords"]}
              </td>
              <td as-element="small-bar" percent="${sim.text_similarity}" orientation="vertical" xSize="20" ySize="100">
              </td>
              <td as-element="small-bar" percent="${sim.keyword_similarity}" orientation="vertical" xsize="20"
                ysize="100"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Document Info View -->
      <div class="row" style="overflow: scroll; height: 40vh;">
        <h6>${selected_document["Title"]} </h6>
        <strong>Authors: </strong> ${selected_document["Authors"]}
        <br>
        <a href=${selected_document["DOI"]}>Link to the official Source (DOI)</a>
        <br>
        <strong>Author Keywords: </strong> ${selected_document["Keywords"]}
        <div class="collapsible-basic-use">
          <ul md-collapsible="accordion.bind: !accordion; popout: false;">
            <li>
              <div class="collapsible-header">Abstract</div>
              <div class="collapsible-body">
                <p>${selected_document["Abstract"]}</p>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</template>